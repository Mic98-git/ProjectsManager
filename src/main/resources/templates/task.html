<html>
	<head>
		<title>Task</title>
		<link rel="stylesheet" type="text/css" href="../static/css/style.css" th:href="@{/css/style.css}">
	</head>
	<body>
		<th:block th:replace="navbar :: topbar"></th:block>

		<h1 th:text="${'Task: ' + task.name}">Task</h1>

		<div th:text="${'ID: ' + task.id}">id</div>

		<div>Completed: <span th:text="${task.Completed} ? 'YES' : 'NO'"></span></div>

		<div><a th:href="@{'/projects/' + ${projectId}}">Back to project</a></div>

		<h3>Description</h3>
		<div th:text="${task.description}">desc</div>

		<h3>Tags</h3>
		<table>
			<tr th:each="tag : ${allTaskTags}">
				<td th:text="${tag.name} + ' - ' + ${tag.color}">
				</td>
				<td>
					<!-- form per eliminare il tag -->
					<form th:action="@{'/projects/' + ${projectId} + '/task/' + ${task.id} + '/deletetag/' + ${tag.id}}" method="post" th:object="${tag}">
						<input type="submit" name="button" value="Delete">
					</form>
				</td>
			</tr>
			<tr>
				<th>
					Add a new tag
				</th>
				<td>
					<form method="post" th:action="@{'/projects/' + ${projectId} + '/task/' + ${task.id} + '/addtag'}" th:object="${tagForm}">
						<select th:field="*{id}">
							<th:block th:each="addableTag : ${addableTags}">
								<option th:value="${addableTag.id}" th:text="${addableTag.name}"></option>
							</th:block>
						</select>
						<input type="submit" name="" value="Add tag">
					</form>
				</td>
				<td>
					
				</td>
			</tr>
		</table>

		<br><br>
		<table border="2" width="600">
			<tr>
				<th>Author</th>
				<th>Comment</th>
			</tr>
			<tr th:each="comment : ${task.comments}">
				<td class='commenter_profile'>
					<img src='' width="100" height="100" alt="profile"><br>
					<span class='commenter' th:text="${comment.user.name + ' ' + comment.user.lastName}">author</span>
				</td>
				<td class='comment' th:text="${comment.content}"></td>
			</tr>
			<tr th:if="${task.comments.empty}">
				<td colspan="2">No comment</td>
			</tr>	
		</table>
		<br>

		<form th:action="@{'/projects/' + ${projectId} + '/task/' + ${task.id} + '/addcomment'}" method="post" th:object="${commentForm}">
			<table border="2">
				<tr>
					<td class='commenter_profile'>
						<img src='' width="100" height="100" alt="profile"><br>
						<span class='commenter' th:text="${loggedUser.name + ' ' + loggedUser.lastName}">author</span>
					</td>
					<td class='comment'>
						<textarea th:field="*{content}" placeholder="Write your comment..."></textarea><br>
						<input type="submit" value="Send">
					</td>
				</tr>
			</table>
		</form>

		<form th:if="${!task.completed}" method="post" th:action="@{'/projects/' + ${projectId} + '/task/' + ${task.id} + '/completed'}">
			<input type="submit" name="" value="Mark as completed">
		</form>

		<form method="post" th:action="@{'/projects/' + ${projectId} + '/task/' + ${task.id} + '/delete'}">
			<input type="submit" name="" value="Delete this task">
		</form>

	</body>
</html>